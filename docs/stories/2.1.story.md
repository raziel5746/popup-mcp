# Story 2.1: Implement Workspace Path Detection

## Status
Approved

## Story
**As a** developer,  
**I want** the extension to detect and register workspace paths using VS Code API,  
**so that** popups can be routed accurately in multi-instance environments.

## Acceptance Criteria
1: Extension detects current workspace path on activation.  
2: Registers path with MCP server for routing purposes.  
3: Handles path changes (e.g., workspace switches) dynamically.  
4: Testable with multiple mock instances.

## Tasks / Subtasks
- [ ] Detect workspace path on activation (AC: 1) [Source: architecture/components.md#instance-router]  
  - [ ] Use VS Code workspace API in extension.ts to get path  
  - [ ] Store in global state  
- [ ] Register path with MCP coordination (AC: 2) [Source: architecture/backend-architecture.md#coordination]  
  - [ ] Send path to server or local registry  
- [ ] Handle dynamic changes (AC: 3)  
  - [ ] Listen for onDidChangeWorkspaceFolders event  
  - [ ] Update registration on changes  
- [ ] Add testing support (AC: 4) [Source: architecture/testing-strategy.md#e2e-tests]  
  - [ ] Mock multiple instances in E2E tests  
- [ ] Update status bar with path info if relevant (AC: all)  

## Dev Notes
- **Previous Story Insights**: Builds on single-instance from Epic 1; no specific issues noted.  
- **Data Models**: Extend with workspacePath in requests/registration. [Source: architecture/data-models.md#popuprequest]  
- **API Specifications**: N/A - Internal detection.  
- **Component Specifications**: Use InstanceRouter for registration. [Source: architecture/components.md#instance-router]  
- **File Locations**: Update extension.ts, add to backend/coordination.ts. [Source: architecture/unified-project-structure.md]  
- **Testing Requirements**: E2E for multi-instance. [Source: architecture/testing-strategy.md#e2e-tests]  
- **Technical Constraints**: VS Code API for workspaces. [Source: architecture/tech-stack.md]  

**Project Structure Notes**: Aligns with routing components.

### Testing
- Test file location: tests/e2e/. [Source: architecture/testing-strategy.md#e2e-tests]  
- Test standards: E2E focus. [Source: architecture/testing-strategy.md#testing-pyramid]  
- Testing frameworks and patterns: Playwright for instances. [Source: architecture/testing-strategy.md#e2e-test]  
- Any specific testing requirements for this story: Mock multi-instance path detection.

## Change Log
| Date | Version | Description | Author |  
|------|---------|-------------|--------|  

## Dev Agent Record
### Agent Model Used  

### Debug Log References  

### Completion Notes List  

### File List  

## QA Results
