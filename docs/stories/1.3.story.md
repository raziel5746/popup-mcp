# Story 1.3: Set Up Extension Skeleton and MCP Server

## Status
Approved

## Story
**As a** developer,  
**I want** to create the basic VS Code extension structure with an integrated MCP server,  
**so that** it can handle incoming popup requests via HTTP/stdio.

## Acceptance Criteria
1: Extension activates and initializes MCP server on VS Code startup.  
2: Supports both HTTP and stdio transports with zero configuration.  
3: Basic health-check endpoint or command to verify server is running.  
4: Logs server initialization and any errors appropriately.

## Tasks / Subtasks
- [ ] Create extension skeleton following unified structure (AC: 1) [Source: architecture/unified-project-structure.md]  
  - [ ] Set up package.json with activation events, commands, and dependencies [Source: architecture/tech-stack.md#technology-stack-table]  
  - [ ] Implement extension.ts with activate() and deactivate() functions  
- [ ] Implement MCP server initialization (AC: 1, 2) [Source: architecture/backend-architecture.md#traditional-server-embedded]  
  - [ ] Create src/backend/mcpServer.ts with transport setup for HTTP and stdio  
  - [ ] Ensure zero-config: auto-bind localhost port, stdio listener  
- [ ] Add request handling basics (AC: 2) [Source: architecture/api-specification.md#mcp-protocol-specification]  
  - [ ] Parse incoming JSON-RPC requests in requestHandler.ts  
  - [ ] Implement basic validation middleware  
- [ ] Implement health-check (AC: 3) [Source: architecture/api-specification.md#http-endpoint]  
  - [ ] Add POST /health or command to check server status  
  - [ ] Return simple {status: "active"} response  
- [ ] Add logging (AC: 4) [Source: architecture/tech-stack.md#logging]  
  - [ ] Use VS Code Output Channel for init logs and errors  
  - [ ] Log transport setup, errors with stack traces  
- [ ] Write unit tests for server init and health-check (AC: all) [Source: architecture/testing-strategy.md#backend-tests]  
  - [ ] Create tests/unit/backend/mcpServer.test.ts  
  - [ ] Test activation, transport setup, basic request parsing  

## Dev Notes
- **Previous Story Insights**: No implementation notes from 1.2, as it was documentation-focused with empty Dev Record.  
- **Data Models**: Use PopupRequest interface for incoming requests, including workspacePath, title, message, options. [Source: architecture/data-models.md#popuprequest]  
- **API Specifications**: Implement MCP protocol with JSON-RPC over HTTP (POST /mcp) and stdio; generate requestId on server; support SSE for responses if needed. [Source: architecture/api-specification.md#mcp-protocol-specification]  
- **Component Specifications**: Implement McpServer class with setupTransports() and handleRequest(); use net.createServer for HTTP. [Source: architecture/backend-architecture.md#controller-template]  
- **File Locations**: Place in src/backend/ (mcpServer.ts, requestHandler.ts); main activation in src/extension.ts; follow unified structure. [Source: architecture/unified-project-structure.md]  
- **Testing Requirements**: Use Jest for unit tests on server logic; organize in tests/unit/backend/. [Source: architecture/testing-strategy.md#backend-tests]  
- **Technical Constraints**: Node.js 20.x LTS, TypeScript 5.3.x; no auth, bind localhost for security. [Source: architecture/tech-stack.md#technology-stack-table] [Source: architecture/api-specification.md#integration-notes]  

**Project Structure Notes**: Aligns perfectly with backend organization in unified structure; no conflicts.

### Testing
- Test file location: tests/unit/backend/ for unit tests. [Source: architecture/testing-strategy.md#backend-tests]  
- Test standards: Follow testing pyramid with unit focus for server init/validation. [Source: architecture/testing-strategy.md#testing-pyramid]  
- Testing frameworks and patterns: Jest for backend; mock transports and requests. [Source: architecture/testing-strategy.md#backend-api-test]  
- Any specific testing requirements for this story: Test server activation, transport support, health-check, and error logging scenarios.

## Change Log
| Date | Version | Description | Author |  
|------|---------|-------------|--------|  

## Dev Agent Record
### Agent Model Used  

### Debug Log References  

### Completion Notes List  

### File List  

## QA Results
